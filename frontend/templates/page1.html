{% extends "base.html" %}

{% block content %}
<script src="https://unpkg.com/wavesurfer.js@5.2.0"></script>
<script src="https://unpkg.com/wavesurfer.js@5.2.0/dist/plugin/wavesurfer.regions.min.js"></script>
<script src="/static/audio-editor.js"></script>

<h2>Carregar e Editar Áudio</h2>
<p>Importe o áudio para realizar análise e edição. (somente .wav)</p>

<form id="upload-form">
    <input type="file" id="audio-file" accept=".wav" required />
    <button type="submit">Analisar</button>
</form>

<div id="result">Aguarde enquanto processamos o arquivo...</div>
<div id="waveform" style="margin-top: 20px;"></div>
<div class="audio-controls">
    <button id="playRegionButton" disabled>Ouvir Áudio</button>
    <button id="cutButton" disabled>Cortar Áudio</button>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const audioFileInput = document.getElementById("audio-file");
        const uploadForm = document.getElementById("upload-form");
        const playRegionButton = document.getElementById("playRegionButton");
        const cutButton = document.getElementById("cutButton");

        wavesurfer = initializeWaveSurfer("#waveform");

        uploadForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const file = audioFileInput.files[0];
            if (!file) {
                alert("Por favor, selecione um arquivo .wav.");
                return;
            }
            loadAudio(file);
            playRegionButton.disabled = false;
            cutButton.disabled = false;
        });

        playRegionButton.addEventListener("click", playRegion);
        cutButton.addEventListener("click", cutAudio);
    });
</script>
<img id="fft-plot" src="/fft-plot" alt="FFT Plot" style="display:none; margin-top: 20px;">
    <script src="/static/app.js"></script>
{% endblock %}
