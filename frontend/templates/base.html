<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhonIA</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<script>
  // Desabilita os links enquanto n√£o houver consentimento
  if (!localStorage.getItem("consentGiven")) {
    document.querySelectorAll("nav a").forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        alert("aaVoc√™ precisa aceitar o termo de consentimento para acessar esta p√°gina.");
        window.location.href = "/consent";
      });
    });
  }
</script>
<body>
    <meta charset="UTF-8">
    <header>
        <img src="/static/assets/logo.png" alt="Logotipo" class="logo">
        <img src="/static/assets/phonialogo.png" alt="Logotipo" class="logo">
        <nav>
            <span id="user-display" style="margin-right: 15px; font-weight: bold; color: navy;"></span>
            <a href="/">In√≠cio</a> |
            <a href="/page1">Carregar</a> |
<!--            <a href="/page2">Gravar</a> |-->
            <a href="/instructions">Gravar</a> |
            <a href="/page3">Resultados</a> |
            <a href="/instructions">Tutorial</a> |
            <a href="/consent">Consentimento</a>
            <a href="#" onclick="logoutUser()">Sair</a>
        </nav>
    </header>
    <main>
        {% block content %}{% endblock %}
    </main>
    <footer>
        <p>&copy; 2025 PhonIA WebApp</p>
    </footer>
    <script>
      function logoutUser() {
        console.log("üßπ Limpando sess√£o do usu√°rio...");

        // Remover consentimento e dados do usu√°rio
        localStorage.removeItem("consentGiven");
        localStorage.removeItem("userInfo");
        localStorage.removeItem("authToken");

        // Remover redirecionamentos pendentes
        sessionStorage.clear();

        // Opcional: resetar cabe√ßalho (se quiser feedback visual)
        const display = document.getElementById("user-display");
        if (display) display.textContent = "Usu√°rio N/D";

        // Redirecionar para home e for√ßar reload
        window.location.href = "/";
      }

      function atualizarCabecalhoUsuario() {
        const userData = JSON.parse(localStorage.getItem("userInfo") || "{}");
        const username = userData.username || "n√£o logado";
        const userDisplay = document.getElementById("user-display");
        if (userDisplay) userDisplay.textContent = `Usu√°rio ${username}`;
      }

      document.addEventListener("DOMContentLoaded", atualizarCabecalhoUsuario);
    </script>

    <!-- Popup de aviso m√©dico global -->
    <div id="med-warning-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 400px;">
            <h3>‚ö†Ô∏è Aten√ß√£o</h3>
            <p>Esta ferramenta n√£o substitui o diagn√≥stico m√©dico!<br>
            Os resultados s√£o informativos e n√£o devem ser usados para fins cl√≠nicos sem a avalia√ß√£o de um profissional!!!</p>
            <button onclick="fecharAvisoMedico()">Entendi</button>
        </div>
    </div>

    <script>
      function mostrarAvisoMedico(callback) {
        const popup = document.getElementById("med-warning-popup");
        popup.style.display = "flex";
        popup.querySelector("button").onclick = function () {
          popup.style.display = "none";
          if (typeof callback === "function") callback();
        };
      }

      function fecharAvisoMedico() {
        document.getElementById("med-warning-popup").style.display = "none";
      }
    </script>

</body>
<link rel="manifest" href="/static/assets/manifest.json">
</html>
